{
  "name": "Orphan File Detection",
  "description": "Prevents creation of files not connected to the build path",
  "version": "1.0.0",
  "id": "QL-HOOK-005",

  "hook_type": "PreToolUse",
  "tools": ["Write"],

  "conditions": {
    "file_patterns": ["src/**/*", "components/**/*", "lib/**/*"],
    "exclude_patterns": ["**/test*", "**/*.test.*", "**/*.spec.*"]
  },

  "checks": [
    {
      "name": "build_path_connection",
      "description": "Verify new file will be imported somewhere in the build path",
      "steps": [
        {
          "action": "identify_entry_points",
          "files": ["src/index.ts", "src/main.ts", "src/App.tsx", "index.ts", "main.ts"],
          "fallback": "package.json main field"
        },
        {
          "action": "trace_imports",
          "description": "Trace import tree from entry point to verify target location is reachable"
        },
        {
          "action": "check_planned",
          "description": "Verify file is listed in docs/ARCHITECTURE_PLAN.md"
        }
      ],
      "on_orphan": {
        "action": "warn",
        "message": "ORPHAN DETECTION: This file may not be connected to the build path.",
        "questions": [
          "Is this file listed in ARCHITECTURE_PLAN.md-",
          "What file will import this module-",
          "Should the blueprint be updated first-"
        ]
      }
    }
  ],

  "ghost_path_detection": {
    "description": "Check for UI components without backend handlers",
    "patterns": {
      "react_component": "function\\s+\\w+.*\\{.*return.*<",
      "onclick_handler": "onClick\\s*=\\s*\\{([^}]+)\\}",
      "form_submit": "onSubmit\\s*=\\s*\\{([^}]+)\\}"
    },
    "on_ghost": {
      "action": "warn",
      "message": "GHOST PATH: UI element found without verified handler implementation."
    }
  },

  "implementation_notes": {
    "claude_code_hook": "Before creating a new source file, verify it will be imported by existing code or is in the blueprint.",
    "rationale": "Prevents dead code and ensures all created files serve a purpose in the build"
  }
}
